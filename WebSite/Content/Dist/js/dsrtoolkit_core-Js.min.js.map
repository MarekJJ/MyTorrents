{"version":3,"sources":["dsrtoolkit_core-Js.min.js"],"names":["angular","module","config","$httpProvider","$translateProvider","toastrConfig","uiSelectConfig","dynamicNumberStrategyProvider","CurrentLanguage","$provide","interceptors","push","useStaticFilesLoader","prefix","suffix","useSanitizeValueStrategy","addInterpolation","preferredLanguage","theme","resetSearchInput","appendToBody","extend","positionClass","addStrategy","numThousand","numInt","numFract","numNeg","numSep","decorator","$delegate","directive","templateUrl","element","attrs","run","$rootScope","$window","permissionService","datatablesConfigurationService","Permissions","$on","event","toState","toParams","fromState","fromParams","_","isString","permission","hasPermission","preventDefault","isArray","hasAnyPermission","scrollTo","setPermissions","factory","permissionList","permissions","contains","any","this","toastr","$translate","prepareValidationErrorList","validationData","list","forEach","value","key","length","v","showNotification","notificationType","message","timeout","options","closeButton","extendedTimeOut","timeOut","showError","errorMessage","error","showValidationError","allowHtml","showTranslatedNotification","messageKey","interpolationData","that","then","showTranslatedWarning","showTranslatedError","showTranslatedSuccess","showTranslatedInfo","BackendRootUrl","getImageUrl","urlRoot","imageAttachmentId","getPlaceholderUrl","ngProgressFactory","getNextActionId","requestId","progressbar","createInstance","setHeight","setColor","runningActions","start","id","isEmpty","stop","complete","$http","confirmationService","removeActionUrl","confirmationMessageKey","confirmAndRemove","itemIds","warningMessageKey","isNumber","confirmationMesssagePromise","COUNT","warningMessagePromise","showConfirmationPromise","showConfirmationWithWarning","showConfirmation","result","post","remove","removeWithWarning","provider","$stateProvider","$urlRouterProvider","initialize","additionalStates","state","name","url","templatesPath","controller","entityName","permissionRoot","params","previewPermission","$","each","val","otherwise","$get","$timeout","waitFor","conditionFn","callbackFn","link","scope","permissionName","trim","notPermissionFlag","slice","show","hide","template","attr","isChecked","checked","children","toggleClass","$parse","restrict","require","ngModel","update","type","$setViewValue","iCheck","checkboxClass","radioClass","on","e","$apply","target","ngClick","$watch","ngChecked","$viewValue","model","ngDisabled","disabled","$touched","$invalid","invalid","parent","transclude","title","subtitle","label","isRequired","labelClass","undefined","contentClass","formGroupClass","service","markFormAsTouched","form","$error","field","errorField","$submitted","$setTouched","formValidationHelper","submitAction","which","$state","history","back","backButton","go","component","bindings","controllerAs","DTOptionsBuilder","DTColumnBuilder","genericDataTableAjaxProvider","dataTableHelper","$scope","getSelectColumn","modelId","newColumn","withTitle","titleHtml","notSortable","withClass","renderWith","data","full","meta","vm","table","selected","dataTableInstance","prepareModelForTable","rowsData","firstTimeTableFixer","dtOptions","newOptions","withOption","tableDataUrl","withDataProp","settings","api","_iRecordsTotal","rows","count","page","save","ajax","reload","row","index","rowElement","withPaginationType","withBootstrap","columns","splice","dtColumns","goToAddItemView","goToPreviewView","selectedItemId","getSelectedItemIds","goToEditView","goToDetails","removeSelectedItems","itemsToRemove","removeItems","reloadData","uiSelect","searchInput","addClass","removeClass","off","durationHelper","$log","Value","maxValue","step","increment","newValue","decrement","r","Math","max","timeValue","warn","textInput","find","isOpen","focus","onKeyUp","isLast","keyCode","closeOnTabPress","hours","minutes","parentSize","$watchGroup","newValues","textInputValue","moment","format","oldValue","isNaN","time","duration","onChange","min","replace","ngModelCtrl","$formatters","modelValue","$render","$parsers","viewValue","parseInt","GlobalConfiguration","required","placeholder","formCtrl","dateFieldOptions","allowInputToggle","locale","dateTimeFormat","dateFormat","$filter","formattedDateTimeFilter","modelCtrl","inputValue","attachments","readonly","imageAttachmentUrlHelper","Upload","toastrWrapper","getUploadData","isFunction","uploadData","baseUrl","categoryName","getFileAccessUrl","attachmentId","removeFile","attachmentIndex","attachment","response","uploadFile","file","newAttachment","upload","status","evt","progress","loaded","total","isUndefined","imageUrl","uploadImage","imageFile","items","join","hasPermissionPredicate","option","hasAnyRequiredPermission","linkUrlBase","linkUrl","getLinkUrl","item","attachToEvent","eventName","$validate","eventNames","revalidateOn","split","attributes","$validators","maxValueOrNull","minValue","minValueOrNull","greaterThanZero","decimalPlaces","num","match","maxDecimalDigits","isActiveSelectListItem","$eval","selectListItems","selectedItem","active","$q","$asyncValidators","uniqueAsyncValidator","$dirty","resolve","reject","uniqueAsyncValidatorWithData","validatorData","ready","callback","noop","isValid","isBoolean","uniqueWithParentAsyncValidator","modelParentId","parentId","$templateCache","appendVersion","queryParameterSeparator","indexOf","Date","getTime","request","isTemplateCacheRequest","method","get","headers","$injector","responseError","location","isMessageKey","progressActionId","filter","dateTimeWithSecondsFormat","leadingZerosFilter","valueInMinutes","floor","size","s","String","hoursToString","valueInHours","days","instant","minutesToString","textProvider","unit","setText","text","durationValue","durationUnit","durationStep","isMinutesUnit","value1","value2","value1Label","value2Label","$uibModal","showConfirmationModal","confirmationMessage","warningMessage","open","showTranslatedConfirmation","close","dismiss","$ctrl","$onInit","errorCallback","recordsTotal","recordsFilterd","toggleAll","keys","selectAll","toggleOne","checkIfAllSelected","whateverTrue","whateverFalse","allRowSelected","isAnyRowSelected","some","values","all","onlyOneSelected","selectedItems","getFunctionSelected","fcn","call","selectedItemIds","clear","throttle","DTDefaultOptions","setLanguage","$compile","onPreDraw","childScope","$destroy","preDrawCallback","onDraw","$new","processing","processingIndicator","nTableWrapper","css","html","$cookies","ctrl","bodyElement","sidebarMenuElement","append","hasClass","menuSizeClass","put","path","attachActivationSupport","listItem","is","slideUp","slideDown","$root","empty"],"mappings":"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","file":"dsrtoolkit_core-Js.min.js","sourcesContent":["angular\r\n    .module('dsrCommon', ['datatables', 'ui.router', 'ui.bootstrap'])\r\n    .config(['$httpProvider', '$translateProvider', 'toastrConfig', 'uiSelectConfig', 'dynamicNumberStrategyProvider', 'CurrentLanguage', '$provide',\r\n    function ($httpProvider, $translateProvider, toastrConfig, uiSelectConfig, dynamicNumberStrategyProvider, CurrentLanguage, $provide) {\r\n\r\n        $httpProvider.interceptors.push('progressIndicatorInterceptor');\r\n        $httpProvider.interceptors.push('requestInterceptor');\r\n        $httpProvider.interceptors.push('responseNotificationInterceptor');\r\n        $httpProvider.interceptors.push('responseErrorInterceptor');\r\n\r\n        $translateProvider.useStaticFilesLoader({\r\n            prefix: '/Content/Dist/i18n/locale-',\r\n            suffix: '.json'\r\n        });\r\n\r\n        $translateProvider.useSanitizeValueStrategy('escape');\r\n        $translateProvider.addInterpolation('$translateMessageFormatInterpolation');\r\n        $translateProvider.preferredLanguage(CurrentLanguage);\r\n\r\n        uiSelectConfig.theme = 'bootstrap';\r\n        uiSelectConfig.resetSearchInput = true;\r\n        uiSelectConfig.appendToBody = true;\r\n\r\n\r\n        angular.extend(toastrConfig, {\r\n            positionClass: 'toast-bottom-right'\r\n        });\r\n\r\n        dynamicNumberStrategyProvider.addStrategy('byte', {\r\n            numThousand: false,\r\n            numInt: 3,\r\n            numFract: 0,\r\n            numNeg: false\r\n        });\r\n        dynamicNumberStrategyProvider.addStrategy('integer', {\r\n            numSep: '.',\r\n            numThousand: false,\r\n            numInt: 10,\r\n            numFract: 0\r\n        });\r\n        dynamicNumberStrategyProvider.addStrategy('positive-integer', {\r\n            numSep: '.',\r\n            numThousand: false,\r\n            numInt: 10,\r\n            numFract: 0,\r\n            numNeg: false\r\n        });\r\n        dynamicNumberStrategyProvider.addStrategy('decimal', {\r\n            numSep: '.',\r\n            numThousand: false,\r\n            numInt: 10,\r\n            numFract: 8\r\n        });\r\n        dynamicNumberStrategyProvider.addStrategy('positive-decimal', {\r\n            numSep: '.',\r\n            numThousand: false,\r\n            numInt: 10,\r\n            numFract: 8,\r\n            numNeg: false\r\n        });\r\n        dynamicNumberStrategyProvider.addStrategy('small-decimal', {\r\n            numSep: '.',\r\n            numThousand: false,\r\n            numInt: 5,\r\n            numFract: 2\r\n        });\r\n        dynamicNumberStrategyProvider.addStrategy('positive-small-decimal', {\r\n            numSep: '.',\r\n            numThousand: false,\r\n            numInt: 5,\r\n            numFract: 2,\r\n            numNeg: false\r\n        });\r\n\r\n        $provide.decorator('uibAccordionGroupDirective', ['$delegate', function ($delegate) {\r\n            var directive = $delegate[0];\r\n            directive.templateUrl = function(element, attrs) {\r\n                return attrs.templateUrl || './Content/DSRToolkit/Core/Scripts/Common/directives/templates/_accordionOverrideTemplate.html';\r\n            }\r\n            return $delegate;\r\n        }]);\r\n    }])\r\n    .run(['$rootScope', '$window', 'permissionService', 'datatablesConfigurationService', 'Permissions', function ($rootScope, $window, permissionService, datatablesConfigurationService, Permissions) {\r\n\r\n        $rootScope.$on('$stateChangeStart', function (event, toState, toParams, fromState, fromParams) {\r\n            if (_.isString(toState.permission) && !permissionService.hasPermission(toState.permission)) {\r\n                event.preventDefault();\r\n            }\r\n\r\n            if (_.isArray(toState.permission) && !permissionService.hasAnyPermission(toState.permission)) {\r\n                event.preventDefault();\r\n            }\r\n        });\r\n\r\n        $rootScope.$on('$stateChangeSuccess', function () {\r\n            $window.scrollTo(0, 0);\r\n        });\r\n\r\n        permissionService.setPermissions(Permissions);\r\n\r\n        datatablesConfigurationService();\r\n\r\n    }]);\nangular\r\n    .module('dsrCommon')\r\n    .factory('permissionService', function () {\r\n        var permissionList = [];\r\n\r\n        return {\r\n            setPermissions: function (permissions) {\r\n                permissionList = permissions;\r\n            },\r\n\r\n            hasPermission: function (permission) {\r\n                return _.contains(permissionList, permission);\r\n            },\r\n\r\n            hasAnyPermission: function(permissions) {\r\n                return _.any(permissions, this.hasPermission);\r\n            }\r\n        }\r\n    });\nangular\r\n    .module('dsrCommon')\r\n    .factory('toastrWrapper', ['toastr', '$translate', function (toastr, $translate) {\r\n\r\n        function prepareValidationErrorList(validationData) {\r\n            var list = '<ul>';\r\n            angular.forEach(validationData, function (value, key) {\r\n                if (angular.isArray(value) && value.length > 0) {\r\n                    angular.forEach(value, function (v) {\r\n                        list += '<li>' + v + '</li>';\r\n                    })\r\n                }\r\n            });\r\n\r\n            list += '</ul>';\r\n            return list;\r\n        }\r\n\r\n        return {\r\n            showNotification: function (notificationType, message) {\r\n                var timeout = notificationType !== 'error' ? 1500 : 0;\r\n                var options = { closeButton: true, extendedTimeOut: 1000, timeOut: timeout };\r\n                toastr[notificationType](message, options);\r\n            },\r\n\r\n            showError: function(errorMessage) {\r\n                toastr.error(errorMessage, { closeButton: true, extendedTimeOut: 1000, timeOut: 0 });\r\n            },\r\n\r\n            showValidationError: function (errorMessage, validationData) {\r\n                var list = prepareValidationErrorList(validationData);\r\n                toastr.error(list, errorMessage, { closeButton: true, extendedTimeOut: 1000, timeOut: 0, allowHtml: true });\r\n            },\r\n\r\n            showTranslatedNotification: function (notificationType, messageKey, interpolationData) {\r\n                var that = this;\r\n                $translate(messageKey, interpolationData).then(function (errorMessage) {\r\n                    that.showNotification(notificationType, errorMessage);\r\n                });\r\n            },\r\n\r\n            showTranslatedWarning: function (messageKey, interpolationData) {\r\n                this.showTranslatedNotification('warning', messageKey, interpolationData);\r\n            },\r\n\r\n            showTranslatedError: function (messageKey, interpolationData) {\r\n                this.showTranslatedNotification('error', messageKey, interpolationData);\r\n            },\r\n\r\n            showTranslatedSuccess: function (messageKey, interpolationData) {\r\n                this.showTranslatedNotification('success', messageKey, interpolationData);\r\n            },\r\n\r\n            showTranslatedInfo: function (messageKey, interpolationData) {\r\n                this.showTranslatedNotification('info', messageKey, interpolationData);\r\n            }\r\n        }\r\n    }]);\nangular\r\n    .module('dsrCommon')\r\n    .factory('imageAttachmentUrlHelper', ['BackendRootUrl', function (BackendRootUrl) {\r\n        return {\r\n            getImageUrl: function (urlRoot, imageAttachmentId) {\r\n                if (imageAttachmentId) {\r\n                    return BackendRootUrl + urlRoot + imageAttachmentId;\r\n                }\r\n                else {\r\n                    return this.getPlaceholderUrl();\r\n                }\r\n            },\r\n\r\n            getPlaceholderUrl: function () {\r\n                return BackendRootUrl + 'Content/DSRToolkit/Core/Images/no-image-placeholder.png';\r\n            }\r\n        }\r\n    }]);\nangular\r\n    .module('dsrCommon')\r\n    .factory('progressIndicatorService', ['ngProgressFactory', function (ngProgressFactory) {\r\n\r\n        var requestId = 1;\r\n        var progressbar = ngProgressFactory.createInstance();\r\n\r\n        progressbar.setHeight('1px');\r\n        progressbar.setColor('#1ABB9C');\r\n\r\n        function getNextActionId() {\r\n            return requestId++;\r\n        }\r\n\r\n        var runningActions = {};\r\n\r\n        return {\r\n            start: function () {\r\n                var id = getNextActionId();\r\n                if (_.isEmpty(runningActions)) {\r\n                    progressbar.start();\r\n                }\r\n                runningActions[id] = true;\r\n                return id;\r\n            },\r\n            stop: function (id) {\r\n                delete runningActions[id];\r\n                if (_.isEmpty(runningActions)) {\r\n                    progressbar.complete();\r\n                }\r\n            }\r\n        };\r\n    }]);\nangular\r\n    .module('dsrCommon')\r\n    .factory('genericRemoveService', ['$http', '$translate', 'confirmationService', function ($http, $translate, confirmationService) {\r\n        return function (removeActionUrl, confirmationMessageKey) {\r\n\r\n            function confirmAndRemove(itemIds, warningMessageKey) {\r\n                if (angular.isNumber(itemIds)) {\r\n                    itemIds = [itemIds];\r\n                }\r\n\r\n                var confirmationMesssagePromise = $translate(confirmationMessageKey, { COUNT: itemIds.length }, 'messageformat');\r\n                var warningMessagePromise = warningMessageKey ? $translate(warningMessageKey) : null;\r\n\r\n                var showConfirmationPromise = warningMessagePromise\r\n                    ? confirmationService.showConfirmationWithWarning(confirmationMesssagePromise, warningMessagePromise)\r\n                    : confirmationService.showConfirmation(confirmationMesssagePromise);\r\n\r\n                return showConfirmationPromise.result.then(function () {\r\n                    return $http.post(removeActionUrl, { itemIds: itemIds });\r\n                });\r\n            }\r\n\r\n            return {\r\n                remove: function (itemIds) {\r\n                    return confirmAndRemove(itemIds);\r\n                },\r\n\r\n                removeWithWarning: function (itemIds, warningMessageKey) {\r\n                    return confirmAndRemove(itemIds, warningMessageKey);\r\n                }\r\n            };\r\n        };\r\n    }]);\nangular\r\n    .module('dsrCommon')\r\n    .provider('DefaultModuleState', ['$stateProvider', '$urlRouterProvider', function ($stateProvider, $urlRouterProvider) {\r\n\r\n        this.initialize = function (options, additionalStates) {\r\n\r\n            $stateProvider.state({\r\n                name: 'list',\r\n                url: '/',\r\n                templateUrl: options.templatesPath + '_list.html',\r\n                controller: options.entityName + 'ListController as $ctrl',\r\n            });\r\n\r\n            $stateProvider.state({\r\n                name: 'add',\r\n                url: '/add',\r\n                templateUrl: options.templatesPath + '_addOrUpdate.html',\r\n                controller: 'AddOrUpdate' + options.entityName + 'Controller as $ctrl',\r\n                permission: options.permissionRoot + 'Add'\r\n            });\r\n\r\n            $stateProvider.state({\r\n                name: 'edit',\r\n                url: '/edit/{id}',\r\n                templateUrl: options.templatesPath + '_addOrUpdate.html',\r\n                controller: 'AddOrUpdate' + options.entityName + 'Controller as $ctrl',\r\n                permission: options.permissionRoot + 'Edit',\r\n                params: { 'id': '' }\r\n            });\r\n\r\n            $stateProvider.state({\r\n                name: 'preview',\r\n                url: '/preview/{id}',\r\n                templateUrl: options.templatesPath + '_preview.html',\r\n                controller: 'Preview' + options.entityName + 'Controller as $ctrl',\r\n                permission: options.permissionRoot + (options.previewPermission || 'View'),\r\n                params: { 'id': '' }\r\n            });\r\n\r\n            if (additionalStates) {\r\n                $.each(additionalStates, function (key, val) {\r\n                    $stateProvider.state(val);\r\n                });\r\n            }\r\n\r\n            $urlRouterProvider.otherwise('/');\r\n        };\r\n\r\n        this.$get = function () {\r\n            return {\r\n                initialize: this.initialize\r\n            }\r\n        };\r\n    }]);\nangular\r\n    .module('dsrCommon')\r\n    .factory('waitFor', ['$timeout', function ($timeout) {\r\n        function waitFor(conditionFn, callbackFn) {\r\n            if (!conditionFn()) {\r\n                return $timeout(function () {\r\n                    return waitFor(conditionFn, callbackFn);\r\n                }, 100);\r\n            }\r\n\r\n            return callbackFn();\r\n        };\r\n\r\n        return waitFor;\r\n    }]);\nangular\r\n    .module('dsrCommon')\r\n    .directive('hasPermission', ['permissionService', function (permissionService) {\r\n        return {\r\n            link: function (scope, element, attrs) {\r\n                if (!_.isString(attrs.hasPermission)) {\r\n                    throw 'hasPermission value must be a string'\r\n                }\r\n\r\n                var permissionName = attrs.hasPermission.trim();\r\n                var notPermissionFlag = permissionName[0] === '!';\r\n                if (notPermissionFlag) {\r\n                    permissionName = permissionName.slice(1).trim();\r\n                }\r\n\r\n                var hasPermission = permissionService.hasPermission(permissionName);\r\n                if (hasPermission && !notPermissionFlag || !hasPermission && notPermissionFlag) {\r\n                    element.show();\r\n                }\r\n                else {\r\n                    element.hide();\r\n                }\r\n            }\r\n        }\r\n    }]);\nangular\r\n    .module('dsrCommon')\r\n    .directive('readonlyCheckbox', function () {\r\n        return {\r\n            template: '<div class=\"icheckbox_flat-green disabled\"></div>',\r\n            link: function (scope, element, attr) {\r\n                var isChecked = attr.checked === 'true';\r\n                element.children().toggleClass('checked', isChecked);\r\n            }\r\n        }\r\n    })\r\n    .directive('icheck', ['$timeout', '$parse', function ($timeout, $parse) {\r\n        return {\r\n            restrict: 'A',\r\n            require: 'ngModel',\r\n            link: function (scope, element, attr, ngModel) {\r\n                $timeout(function () {\r\n                    var value = attr.value;\r\n\r\n                    function update(checked) {\r\n                        if (attr.type === 'radio') {\r\n                            ngModel.$setViewValue(value);\r\n                        } else {\r\n                            ngModel.$setViewValue(checked);\r\n                        }\r\n                    }\r\n\r\n                    element.iCheck({\r\n                        checkboxClass: attr.checkboxClass || 'icheckbox_flat-green',\r\n                        radioClass: attr.radioClass || 'iradio_flat-green'\r\n                    }).on('ifChanged', function (e) {\r\n                        $timeout(function () {\r\n                            scope.$apply(function () {\r\n                                update(e.target.checked);\r\n                            });\r\n                            scope.$apply(attr.ngClick);\r\n                        });\r\n                    });\r\n\r\n                    scope.$watch(function () { return attr.ngChecked }, function (checked) {\r\n                        if (typeof checked === 'undefined') checked = !!ngModel.$viewValue;\r\n                        update(checked)\r\n                    }, true);\r\n\r\n                    scope.$watch(attr.ngModel, function (model) {\r\n                        element.iCheck('update');\r\n                    }, true);\r\n\r\n                    scope.$watch(attr.ngDisabled, function (disabled) {\r\n                        element.iCheck('update');\r\n                    });\r\n\r\n                    scope.$watch(function () {\r\n                        return ngModel.$touched && ngModel.$invalid;\r\n                    }, function (invalid) {\r\n                        element.parent().toggleClass('invalid', invalid);\r\n                    })\r\n\r\n                    scope.$on('$destroy', function () {\r\n                        element.iCheck('destroy');\r\n                    });\r\n                })\r\n            }\r\n        }\r\n    }]);\r\n\nangular\r\n    .module('dsrCommon')\r\n    .directive('viewHeader', [function () {\r\n        return {\r\n            restrict: 'E',\r\n            transclude: true,\r\n            templateUrl: './Content/DSRToolkit/Core/Scripts/Common/directives/templates/_viewHeaderTemplate.html',\r\n            scope: {\r\n                title: '@',\r\n                subtitle: '@'\r\n            }\r\n        };\r\n    }]);\nangular\r\n    .module('dsrCommon')\r\n    .directive('formGroup', [function () {\r\n        return {\r\n            restrict: 'E',\r\n            template: ' <div class=\"{{formGroupClass}}\"><label class=\"{{labelClass}} control-label\">{{ label }}:<span ng-if=\"isRequired\" class=\"required-field-marker\">*</span></label><div class=\"{{contentClass}}\"><ng-transclude /></div></div>',\r\n            transclude: true,\r\n            scope: {\r\n                label: '@',\r\n                isRequired: '<'\r\n            },\r\n            link: function (scope, element, attrs) {\r\n                scope.labelClass = 'col-sm-3 col-xs-12';\r\n                if (attrs.labelClass !== undefined) {\r\n                    scope.labelClass = attrs.labelClass;\r\n                }\r\n                scope.contentClass = 'col-sm-8 col-lg-6 col-xs-12';\r\n                if (attrs.contentClass !== undefined) {\r\n                    scope.contentClass = attrs.contentClass;\r\n                }\r\n                scope.formGroupClass = 'form-group';\r\n                if (attrs.formGroupClass !== undefined) {\r\n                    scope.formGroupClass = attrs.formGroupClass;\r\n                }\r\n            }\r\n        };\r\n    }]);\nangular\r\n    .module('dsrCommon')\r\n    .service('formValidationHelper', function () {\r\n\r\n        function markFormAsTouched(form) {\r\n            angular.forEach(form.$error, function (field) {\r\n                angular.forEach(field, function (errorField) {\r\n                    if (errorField.$submitted !== undefined) {\r\n                        markFormAsTouched(errorField);\r\n                    } else {\r\n                        errorField.$setTouched();\r\n                    }\r\n                });\r\n            });\r\n        }\r\n\r\n        return {\r\n            markFormAsTouched: markFormAsTouched\r\n        }\r\n    })\r\n    .directive('formSubmitOnEnter', ['formValidationHelper', function (formValidationHelper) {\r\n        return {\r\n            scope: {\r\n                submitAction: '&formSubmitOnEnter',\r\n                form: '<'\r\n            },\r\n            link: function (scope, element, attrs) {\r\n                element.on('keypress', function(event) {\r\n                    if (event.which === 13) {\r\n                        event.preventDefault();\r\n                        scope.$apply(function () {\r\n                            if (scope.form.$invalid) {\r\n                                formValidationHelper.markFormAsTouched(scope.form);\r\n                            } else {\r\n                                scope.submitAction();\r\n                            }\r\n                        });\r\n                    }\r\n                });\r\n            }\r\n        };\r\n    }])\r\n    .directive('formSubmitButton', ['$timeout', 'formValidationHelper', function ($timeout, formValidationHelper) {\r\n        return {\r\n            scope: {\r\n                submitAction: '&formSubmitButton',\r\n                form: '<'\r\n            },\r\n            link: function (scope, element, attrs) {\r\n                element.on('click', function () {\r\n                    $timeout(function () {\r\n                        if (scope.form.$invalid) {\r\n                            formValidationHelper.markFormAsTouched(scope.form);\r\n                        } else {\r\n                            scope.submitAction();\r\n                        }\r\n                    })\r\n                })\r\n            }\r\n        };\r\n    }]);\r\n\nangular\r\n    .module('dsrCommon')\r\n    .directive('backButton', ['$window', '$state', function ($window, $state) {\r\n        return {\r\n            restrict: 'A',\r\n            link: function (scope, element, attrs) {\r\n                element.on('click', function () {\r\n                    if ($window.history.length > 1) {\r\n                        $window.history.back();\r\n                    }\r\n                    else if (attrs.backButton) {\r\n                        $state.go(attrs.backButton);\r\n                    }\r\n                });\r\n\r\n            }\r\n        }\r\n    }]);\nangular\r\n    .module('dsrCommon')\r\n    .component('defaultListView', {\r\n        bindings: {\r\n            title: '@',\r\n            options: '='\r\n        },\r\n        templateUrl: './Content/DSRToolkit/Core/Scripts/Common/directives/templates/_defaultListViewTemplate.html',\r\n        controllerAs: 'defaultListViewCtrl',\r\n        controller: ['DTOptionsBuilder', 'DTColumnBuilder', '$state', 'genericDataTableAjaxProvider', 'dataTableHelper', 'permissionService', '$timeout', '$scope',\r\n         function (DTOptionsBuilder, DTColumnBuilder, $state, genericDataTableAjaxProvider, dataTableHelper, permissionService, $timeout, $scope) {\r\n             var vm = this;\r\n\r\n             vm.dataTableInstance = {};\r\n             vm.table = dataTableHelper.prepareModelForTable();\r\n             vm.rowsData = [];\r\n             vm.firstTimeTableFixer = false;\r\n\r\n             var modelId = vm.options.modelId || 'id';\r\n             var titleHtml = '<input ng-model=\"defaultListViewCtrl.table.selectAll\" ng-click=\"defaultListViewCtrl.table.toggleAll()\" type=\"checkbox\" icheck  />';\r\n\r\n             vm.dtOptions = DTOptionsBuilder.newOptions()\r\n                 .withOption('ajax', genericDataTableAjaxProvider(vm.options.tableDataUrl))\r\n                 .withDataProp('data')\r\n                 .withOption('paging', true)\r\n                 .withOption('stateSave', true)\r\n                 .withOption('stateDuration', -1)\r\n                 .withOption('processing', true)\r\n                 .withOption('serverSide', true)\r\n                 .withOption('preDrawCallback', function (settings) {\r\n                     var api = this.api();\r\n                     // if row count 0, always set page to 1\r\n                     if (!vm.firstTimeTableFixer && settings._iRecordsTotal > 0 && api.rows().count() === 0) {\r\n                         vm.firstTimeTableFixer = true;\r\n                         api.page('first').state.save();\r\n                         $timeout(api.ajax.reload);\r\n                     }\r\n                 })\r\n                 .withOption('createdRow', function (row, data, index) {\r\n                     var rowElement = angular.element(row);\r\n                     rowElement.attr('ng-class', '{\"selected\" : defaultListViewCtrl.table.selected[\\'' + data[modelId] + '\\']}');\r\n                     rowElement.attr('ng-click', 'defaultListViewCtrl.table.toggleOne(\\'' + data[modelId] + '\\')');\r\n                     rowElement.attr('ng-dblclick', 'defaultListViewCtrl.goToDetails(\\'' + data[modelId] + '\\')');\r\n\r\n                     vm.rowsData[index] = data;\r\n                 })\r\n                 .withPaginationType('full_numbers')\r\n                 .withBootstrap();\r\n\r\n             function getSelectColumn(modelId) {\r\n                 return DTColumnBuilder\r\n                     .newColumn(modelId)\r\n                     .withTitle(titleHtml)\r\n                     .notSortable()\r\n                     .withClass('select-checkbox')\r\n                     .renderWith(function (data, type, full, meta) {\r\n                         var key = full[modelId];\r\n                         vm.table.selected[key] = false;\r\n                         return '<input ng-model=\"defaultListViewCtrl.table.selected[\\'' + key + '\\']\" ng-click=\"defaultListViewCtrl.table.checkIfAllSelected()\" type=\"checkbox\" icheck />';\r\n                     });\r\n             }\r\n\r\n             vm.options.columns.splice(0, 0, getSelectColumn(modelId));\r\n             vm.dtColumns = vm.options.columns;\r\n\r\n             vm.goToAddItemView = function () {\r\n                 $state.go('add');\r\n             };\r\n\r\n             vm.goToPreviewView = function (id) {\r\n                 var selectedItemId = id || vm.table.getSelectedItemIds()[0];\r\n                 $state.go('preview', { id: selectedItemId });\r\n             };\r\n\r\n             vm.goToEditView = function (id) {\r\n                 var selectedItemId = id || vm.table.getSelectedItemIds()[0];\r\n                 $state.go('edit', { id: selectedItemId });\r\n             };\r\n\r\n             vm.goToDetails = function (id) {\r\n                 if (permissionService.hasPermission(vm.options.permissions['edit'])) {\r\n                     vm.goToEditView(id);\r\n                 }\r\n                 else if (permissionService.hasPermission(vm.options.permissions['view'])) {\r\n                     vm.goToPreviewView(id);\r\n                 }\r\n             };\r\n\r\n             vm.removeSelectedItems = function () {\r\n                 var itemsToRemove = vm.table.getSelectedItemIds();\r\n                 vm.options.removeItems(itemsToRemove).then(function () {\r\n                     vm.dataTableInstance.reloadData();\r\n                 });\r\n             };\r\n\r\n             $scope.$on('event:reload-datatable', function () {\r\n                 vm.dataTableInstance.reloadData();\r\n             });\r\n         }]\r\n    });\nangular\r\n    .module('dsrCommon')\r\n    .directive('uiSelectMultipleFocusFix', function () {\r\n        return {\r\n            restrict: 'A',\r\n            require: 'uiSelect',\r\n            link: function (scope, element, attr, uiSelect) {\r\n                var searchInput = uiSelect.searchInput;\r\n\r\n                searchInput.on('focus', function () {\r\n                    element.addClass('focus');\r\n                });\r\n\r\n                searchInput.on('blur', function () {\r\n                    element.removeClass('focus');\r\n                });\r\n\r\n                scope.$on('$destroy', function () {\r\n                    searchInput.off('focus');\r\n                    searchInput.off('blur');\r\n                });\r\n            }\r\n        };\r\n    });\nangular\r\n    .module('dsrCommon')\r\n    .directive('timePicker', ['$timeout', '$translate', 'durationHelper', '$log', function ($timeout, $translate, durationHelper, $log) {\r\n        function Value(maxValue, step) {\r\n            this.value = 0;\r\n            this.maxValue = maxValue;\r\n            this.step = step || 1;\r\n\r\n            this.increment = function () {\r\n                var newValue = this.value + this.step;\r\n                newValue = newValue - (newValue % this.step);\r\n                this.value = newValue <= this.maxValue ? newValue : 0;\r\n            };\r\n\r\n            this.decrement = function () {\r\n                if (this.value > 0) {\r\n                    var r = this.value % this.step;\r\n                    var newValue = r > 0\r\n                        ? this.value - r\r\n                        : this.value - this.step;\r\n\r\n                    this.value = Math.max(0, newValue);\r\n                } else {\r\n                    this.value = this.maxValue + 1 - this.step;\r\n                }\r\n            };\r\n        }\r\n\r\n        return {\r\n            templateUrl: './Content/DSRToolkit/Core/Scripts/Common/directives/templates/timePicker.template.html',\r\n            scope: {\r\n                timeValue: '='\r\n            },\r\n            link: function (scope, element, attrs) {\r\n                $log.warn('timePicker directive is depreciated, please use dsrTimePicker with ng-model instead.');\r\n\r\n                var textInput = element.find('input[type=text]');\r\n\r\n                textInput.on('focus', function () {\r\n                    scope.$apply(function () {\r\n                        scope.isOpen = true;\r\n\r\n                        $timeout(function () {\r\n                            element.find('.popover-content input:first').focus();\r\n                        }, 100);\r\n                    });\r\n                });\r\n\r\n                element.find('.input-group-addon').on('click', function () {\r\n                    textInput.focus();\r\n                });\r\n\r\n                scope.onKeyUp = function (event, value, isLast) {\r\n                    if (event.keyCode === 38) {\r\n                        value.increment();\r\n\r\n                    } else if (event.keyCode === 40) {\r\n                        value.decrement();\r\n                    }\r\n                };\r\n\r\n                scope.closeOnTabPress = function (event) {\r\n                    if (event.keyCode === 9) {\r\n                        scope.isOpen = false;\r\n                    }\r\n                };\r\n\r\n                scope.hide = function () {\r\n                    scope.isOpen = false;\r\n                };\r\n\r\n                scope.hours = new Value(23);\r\n                scope.minutes = new Value(59, 15);\r\n\r\n                var isMinutesUnit = true;\r\n                var parentSize = 60;\r\n\r\n                scope.$watchGroup(['hours.value', 'minutes.value'], function (newValues) {\r\n                    var value = scope.hours.value * parentSize + scope.minutes.value;\r\n\r\n                    scope.textInputValue = moment(0).hours(0).minutes(value).format('HH:mm');\r\n                    scope.timeValue = value;\r\n                });\r\n\r\n                scope.$watch('timeValue', function (newValue, oldValue) {\r\n                    if (newValue === undefined || isNaN(newValue))\r\n                        return;\r\n\r\n                    var time = moment.duration(newValue, 'minutes');\r\n\r\n                    scope.hours.value = time.hours();\r\n                    scope.minutes.value = time.minutes();\r\n                });\r\n\r\n                scope.onChange = function (value, maxValue) {\r\n                    value.value = Math.min(value.value, maxValue);\r\n                }\r\n            }\r\n        };\r\n    }])\r\n    .directive('dsrTimePicker', ['$timeout', function ($timeout) {\r\n        function Value(maxValue, step) {\r\n            this.value = 0;\r\n            this.maxValue = maxValue;\r\n            this.step = step || 1;\r\n\r\n            this.increment = function () {\r\n                var newValue = this.value + this.step;\r\n                newValue = newValue - (newValue % this.step);\r\n                this.value = newValue <= this.maxValue ? newValue : 0;\r\n            };\r\n\r\n            this.decrement = function () {\r\n                if (this.value > 0) {\r\n                    var r = this.value % this.step;\r\n                    var newValue = r > 0\r\n                        ? this.value - r\r\n                        : this.value - this.step;\r\n\r\n                    this.value = Math.max(0, newValue);\r\n                } else {\r\n                    this.value = this.maxValue + 1 - this.step;\r\n                }\r\n            };\r\n        }\r\n\r\n        return {\r\n            restrict: 'E',\r\n            templateUrl: './Content/DSRToolkit/Core/Scripts/Common/directives/templates/dsrTimePicker.template.html',\r\n            require: 'ngModel',\r\n            replace: true,\r\n            link: function (scope, element, attrs, ngModelCtrl) {\r\n\r\n                var textInput = element.find('input[type=text]');\r\n\r\n                scope.hours = new Value(23);\r\n                scope.minutes = new Value(59, 15);\r\n                scope.ngModelCtrl = ngModelCtrl;\r\n\r\n                textInput.on('focus', function () {\r\n                    scope.$apply(function () {\r\n                        scope.isOpen = true;\r\n\r\n                        ngModelCtrl.$setTouched();\r\n\r\n                        $timeout(function () {\r\n                            element.find('.popover-content input:first').focus();\r\n                        }, 100);\r\n                    });\r\n                });\r\n\r\n                element.find('.input-group-addon').on('click', function () {\r\n                    textInput.focus();\r\n                });\r\n\r\n                scope.onKeyUp = function (event, value, isLast) {\r\n                    if (event.keyCode === 38) {\r\n                        value.increment();\r\n\r\n                    } else if (event.keyCode === 40) {\r\n                        value.decrement();\r\n                    }\r\n                };\r\n\r\n                scope.closeOnTabPress = function (event) {\r\n                    if (event.keyCode === 9) {\r\n                        scope.isOpen = false;\r\n                    }\r\n                };\r\n\r\n                scope.hide = function () {\r\n                    scope.isOpen = false;\r\n                };\r\n\r\n                ngModelCtrl.$formatters.push(function (modelValue) {\r\n                    if (modelValue === undefined || isNaN(modelValue))\r\n                        return;\r\n\r\n                    var time = moment.duration(modelValue, 'minutes');\r\n\r\n                    return {\r\n                        hours: time.hours(),\r\n                        minutes: time.minutes()\r\n                    };\r\n                });\r\n\r\n                ngModelCtrl.$render = function () {\r\n                    if (ngModelCtrl.$viewValue) {\r\n                        scope.hours.value = ngModelCtrl.$viewValue.hours;\r\n                        scope.minutes.value = ngModelCtrl.$viewValue.minutes;\r\n                        scope.textInputValue = moment(0)\r\n                            .hours(scope.hours.value)\r\n                            .minutes(scope.minutes.value)\r\n                            .format('HH:mm');\r\n                    }\r\n                };\r\n\r\n                ngModelCtrl.$parsers.push(function (viewValue) {\r\n                    var hours = viewValue.hours,\r\n                        minutes = viewValue.minutes;\r\n\r\n                    return hours * 60 + minutes;\r\n                });\r\n\r\n                scope.$watchGroup(['hours.value', 'minutes.value'], function (newValues) {\r\n                    ngModelCtrl.$setViewValue({\r\n                        hours: Math.min(parseInt(newValues[0]), 23),\r\n                        minutes: Math.min(parseInt(newValues[1]), 59)\r\n                    });\r\n\r\n                    ngModelCtrl.$render();\r\n                });\r\n            }\r\n        }\r\n    }])\r\n    .directive('datePicker', ['CurrentLanguage', 'GlobalConfiguration', function (CurrentLanguage, GlobalConfiguration) {\r\n         return {\r\n             templateUrl: './Content/DSRToolkit/Core/Scripts/Common/directives/templates/_datePickerTemplate.html',\r\n             require: '^^form',\r\n             scope: {\r\n                 name: '@',\r\n                 model: '=',\r\n                 field: '@',\r\n                 required: '=',\r\n                 type: '@',\r\n                 placeholder: '@',\r\n                 disabled: '='\r\n             },\r\n             link: function (scope, element, attrs, formCtrl) {\r\n                 scope.formCtrl = formCtrl;\r\n\r\n                 scope.dateFieldOptions = {\r\n                     allowInputToggle: true,\r\n                     locale: CurrentLanguage,\r\n                     format: scope.type === 'dateTime' ? GlobalConfiguration.dateTimeFormat : GlobalConfiguration.dateFormat\r\n                 };\r\n\r\n                 scope.show = true;\r\n             }\r\n         }\r\n     }]);\nangular\r\n    .module('dsrCommon')\r\n    .directive('dateTimeFormatter', ['$filter', function ($filter) {\r\n        var formattedDateTimeFilter = $filter('formattedDateTime');\r\n\r\n        return {\r\n            require: 'ngModel',\r\n            link: function (scope, element, attrs, modelCtrl) {\r\n                modelCtrl.$formatters.push(function (inputValue) {\r\n                    return formattedDateTimeFilter(inputValue);\r\n                });\r\n            }\r\n        };\r\n    }]);\nangular\r\n    .module('dsrCommon')\r\n    .component('attachmentPanel', {\r\n        templateUrl: './Content/DSRToolkit/Core/Scripts/Common/directives/templates/_attachmentPanel.template.html',\r\n        bindings: {\r\n            attachments: '=',\r\n            options: '<',\r\n            readonly: '<'\r\n        },\r\n        controller: ['$translate', '$http', 'confirmationService', 'imageAttachmentUrlHelper', 'Upload', 'toastrWrapper',\r\n         function ($translate, $http, confirmationService, imageAttachmentUrlHelper, Upload, toastrWrapper) {\r\n            var vm = this;\r\n\r\n            vm.baseUrl = 'Attachments/' + vm.options.categoryName;\r\n\r\n            function getUploadData(){\r\n                return angular.isFunction(vm.options.uploadData)\r\n                    ? vm.options.uploadData() : vm.options.uploadData;\r\n            }\r\n\r\n            vm.getFileAccessUrl = function (attachmentId) {\r\n                return imageAttachmentUrlHelper.getImageUrl(vm.baseUrl + '/GetFileAttachment/', attachmentId);\r\n            }\r\n\r\n            vm.removeFile = function (attachmentIndex) {\r\n                var confirmationMesssagePromise = $translate('requests.attachmentRemoveConfirmationMessage', { COUNT: 1 }, 'messageformat');\r\n                var attachment = vm.attachments[attachmentIndex];\r\n\r\n                return confirmationService.showConfirmation(confirmationMesssagePromise).result.then(function () {\r\n                    var data = angular.extend({ id: attachment.id }, getUploadData());\r\n                    return $http.post(vm.baseUrl + '/RemoveFileAttachment', data).then(function (response) {\r\n                        vm.attachments.splice(attachmentIndex, 1);\r\n                    });\r\n                });\r\n            }\r\n\r\n            vm.uploadFile = function () {\r\n                var file = vm.newAttachment;\r\n\r\n                var data = {\r\n                    url: vm.baseUrl + '/UploadFileAttachment',\r\n                    data: angular.extend({ file: file }, getUploadData())\r\n                };\r\n\r\n                Upload.upload(data).then(function (response) {\r\n                    vm.attachments.push(response.data);\r\n                    vm.newAttachment = null;\r\n                }, function (response) {\r\n                    if (response.status > 0 && response.status !== 403) {\r\n                        toastrWrapper.showError(response.status + ': ' + response.data);\r\n                    }\r\n                }, function (evt) {\r\n                    // Math.min is to fix IE which reports 200% sometimes\r\n                    file.progress = Math.min(100, parseInt(100.0 * evt.loaded / evt.total));\r\n                });\r\n            };\r\n        }]\r\n    });\nangular\r\n    .module('dsrCommon')\r\n    .component('imageAttachmentPanel', {\r\n        templateUrl: './Content/DSRToolkit/Core/Scripts/Common/directives/templates/imageAttachmentPanel.template.html',\r\n        bindings: {\r\n            imageAttachmentId: '=',\r\n            options: '<',\r\n            readonly: '<'\r\n        },\r\n        controller: ['$scope', 'imageAttachmentUrlHelper', 'Upload', 'toastrWrapper', function ($scope, imageAttachmentUrlHelper, Upload, toastrWrapper) {\r\n             var vm = this;\r\n\r\n             function getImageUrl(imageAttachmentId) {\r\n                 var baseUrl = 'Attachments/' + vm.options.categoryName + '/GetFileAttachment/';\r\n                 return imageAttachmentUrlHelper.getImageUrl(baseUrl, imageAttachmentId);\r\n             }\r\n\r\n             function getUploadData(){\r\n                 return angular.isFunction(vm.options.uploadData)\r\n                     ? vm.options.uploadData() : vm.options.uploadData;\r\n             }\r\n\r\n             $scope.$watch(function () { return vm.imageAttachmentId; }, function (attachmentId) {\r\n                 if (!angular.isUndefined(attachmentId)) {\r\n                     vm.imageUrl = getImageUrl(attachmentId);\r\n                 }\r\n             });\r\n\r\n             vm.uploadImage = function () {\r\n                 var file = vm.imageFile;\r\n                 var url = 'Attachments/' + vm.options.categoryName + '/UploadImageAttachment';\r\n                 var data = angular.extend({ file: file }, getUploadData());\r\n\r\n                 Upload.upload({ url: url, data: data })\r\n                     .then(function (response) {\r\n                         vm.imageAttachmentId = response.data.id;\r\n                         vm.imageUrl = getImageUrl(vm.imageAttachmentId);\r\n                         vm.imageFile = null;\r\n                     }, function (response) {\r\n                         if (response.status > 0) {\r\n                             toastrWrapper.showError(response.status + ': ' + response.data);\r\n                         }\r\n                     }, function (evt) {\r\n                         // Math.min is to fix IE which reports 200% sometimes\r\n                         file.progress = Math.min(100, parseInt(100.0 * evt.loaded / evt.total));\r\n                     });\r\n             };\r\n         }]\r\n    });\nangular\r\n    .module('dsrCommon')\r\n    .component('linkList', {\r\n        bindings: {\r\n            items: '<',\r\n            options: '<'\r\n        },\r\n        template: [\r\n            '<div ng-repeat=\"item in $ctrl.items track by $index\">',\r\n                '<span ng-if=\"$ctrl.hasAnyRequiredPermission\"><a ng-href=\"{{$ctrl.getLinkUrl(item)}}\" class =\"link\">{{ item.name }}</a></span>',\r\n                '<span ng-if=\"!$ctrl.hasAnyRequiredPermission\">{{ item.name }}</span>',\r\n            '</div>'\r\n        ].join(''),\r\n        controller: ['BackendRootUrl', 'permissionService', function (BackendRootUrl, permissionService) {\r\n            var vm = this;\r\n\r\n            function hasPermissionPredicate(option) {\r\n                return permissionService.hasPermission(option.permission);\r\n            }\r\n\r\n            vm.hasAnyRequiredPermission = _.any(vm.options, hasPermissionPredicate);\r\n\r\n            if (vm.hasAnyRequiredPermission) {\r\n                var option = _.find(vm.options, hasPermissionPredicate);\r\n                vm.linkUrlBase = BackendRootUrl + option.linkUrl;\r\n            }\r\n\r\n            vm.getLinkUrl = function (item) {\r\n                return vm.linkUrlBase + item.id;\r\n            }\r\n\r\n        }]\r\n    });\nangular\r\n    .module('dsrCommon')\r\n    .directive('revalidateOn', [function () {\r\n        return {\r\n            restrict: 'A',\r\n            require: 'ngModel',\r\n            link: function (scope, element, attrs, ngModel) {\r\n\r\n                function attachToEvent(eventName) {\r\n                    scope.$on(eventName, function () {\r\n                        ngModel.$validate();\r\n                    });\r\n                }\r\n\r\n                var eventNames = attrs.revalidateOn.split(',');\r\n\r\n                angular.forEach(eventNames, function (eventName) {\r\n                    attachToEvent(eventName);\r\n                });\r\n            }\r\n        }\r\n    }])\r\n    .directive('maxValue', ['$parse', function ($parse) {\r\n        return {\r\n            restrict: 'A',\r\n            require: 'ngModel',\r\n            link: function (scope, element, attributes, ngModel) {\r\n                ngModel.$validators.maxValue = function (modelValue) {\r\n\r\n                    if (!_.isNumber(modelValue) || _.isNaN(modelValue)) {\r\n                        ngModel.$viewValue = null;\r\n                        ngModel.$render();\r\n                        return true;\r\n                    }\r\n\r\n                    var maxValue = $parse(attributes.maxValue)(scope);\r\n                    return modelValue <= maxValue;\r\n                };\r\n            }\r\n        };\r\n    }])\r\n    .directive('maxValueOrNull', ['$parse', function ($parse) {\r\n        return {\r\n            restrict: 'A',\r\n            require: 'ngModel',\r\n            link: function (scope, element, attributes, ngModel) {\r\n                ngModel.$validators.maxValueOrNull = function (modelValue) {\r\n\r\n                    if (!_.isNumber(modelValue) || _.isNaN(modelValue)) {\r\n                        ngModel.$viewValue = null;\r\n                        ngModel.$render();\r\n                        return true;\r\n                    }\r\n\r\n                    var maxValue = $parse(attributes.maxValueOrNull)(scope);\r\n                    if (!_.isNumber(maxValue) || _.isNaN(maxValue))\r\n                        return true;\r\n\r\n                    return modelValue <= maxValue;\r\n                };\r\n            }\r\n        };\r\n    }])\r\n    .directive('minValue', ['$parse', function ($parse) {\r\n        return {\r\n            restrict: 'A',\r\n            require: 'ngModel',\r\n            link: function (scope, element, attributes, ngModel) {\r\n                ngModel.$validators.minValue = function (modelValue) {\r\n                    if (!_.isNumber(modelValue) || _.isNaN(modelValue)) {\r\n                        ngModel.$viewValue = null;\r\n                        ngModel.$render();\r\n                        return true;\r\n                    }\r\n\r\n                    var minValue = $parse(attributes.minValue)(scope);\r\n                    return modelValue >= minValue;\r\n                };\r\n            }\r\n        };\r\n    }])\r\n    .directive('minValueOrNull', ['$parse', function ($parse) {\r\n        return {\r\n            restrict: 'A',\r\n            require: 'ngModel',\r\n            link: function (scope, element, attributes, ngModel) {\r\n                ngModel.$validators.minValueOrNull = function (modelValue) {\r\n\r\n                    if (!_.isNumber(modelValue) || _.isNaN(modelValue)) {\r\n                        ngModel.$viewValue = null;\r\n                        ngModel.$render();\r\n                        return true;\r\n                    }\r\n\r\n                    var minValue = $parse(attributes.minValueOrNull)(scope);\r\n                    if (!_.isNumber(minValue) || _.isNaN(minValue))\r\n                        return true;\r\n\r\n                    return modelValue >= minValue;\r\n                };\r\n            }\r\n        };\r\n    }])\r\n    .directive('greaterThanZero', ['$parse', function ($parse) {\r\n        return {\r\n            restrict: 'A',\r\n            require: 'ngModel',\r\n            link: function (scope, element, attributes, ngModel) {\r\n                ngModel.$validators.greaterThanZero = function (modelValue) {\r\n                    if (!_.isNumber(modelValue) || _.isNaN(modelValue)) {\r\n                        ngModel.$viewValue = null;\r\n                        ngModel.$render();\r\n                        return true;\r\n                    }\r\n\r\n                    return modelValue > 0;\r\n                };\r\n            }\r\n        };\r\n    }])\r\n    .directive('maxDecimalDigits', ['$parse', function ($parse) {\r\n        return {\r\n            restrict: 'A',\r\n            require: 'ngModel',\r\n            link: function (scope, element, attributes, ngModel) {\r\n                function decimalPlaces(num) {\r\n                    var match = ('' + num).match(/(?:\\.(\\d+))?(?:[eE]([+-]?\\d+))?$/);\r\n                    if (!match) { return 0; }\r\n                    return Math.max(\r\n                         0,\r\n                         // Number of digits right of decimal point.\r\n                         (match[1] ? match[1].length : 0)\r\n                         // Adjust for scientific notation.\r\n                         - (match[2] ? +match[2] : 0));\r\n                }\r\n                ngModel.$validators.maxDecimalDigits = function (modelValue) {\r\n                    if (!_.isNumber(modelValue) || _.isNaN(modelValue)) {\r\n                        ngModel.$viewValue = null;\r\n                        ngModel.$render();\r\n                        return true;\r\n                    }\r\n\r\n                    var maxDecimalDigits = $parse(attributes.maxDecimalDigits)(scope);\r\n                    if (!_.isNumber(maxDecimalDigits) || _.isNaN(maxDecimalDigits)) {\r\n                        return true;\r\n                    }\r\n\r\n                    return decimalPlaces(modelValue) <= maxDecimalDigits;\r\n                };\r\n            }\r\n        };\r\n    }]).directive('isActiveSelectListItem', [function () {\r\n        return {\r\n            restrict: 'A',\r\n            require: 'ngModel',\r\n            link: function (scope, element, attributes, ngModel) {\r\n                ngModel.$validators.isActiveSelectListItem = function (modelValue) {\r\n                    var list = scope.$eval(attributes.selectListItems);\r\n\r\n                    var selectedItem = _.find(list, function (item) {\r\n                        return item.value == modelValue;\r\n                    });\r\n\r\n                    var result = selectedItem ? selectedItem.active : true;\r\n                    return result;\r\n                };\r\n            }\r\n        };\r\n    }]);\nangular\r\n    .module('dsrCommon')\r\n    .directive('uniqueAsyncValidator', ['$q', '$http', '$state', function ($q, $http, $state) {\r\n        return {\r\n            restrict: 'A',\r\n            require: 'ngModel',\r\n            link: function (scope, element, attributes, ngModel) {\r\n                ngModel.$asyncValidators.uniqueAsyncValidator = function (modelValue) {\r\n\r\n                    if (!ngModel.$dirty) {\r\n                        return $q.resolve();\r\n                    }\r\n\r\n                    var modelId = scope.$eval(attributes.modelId);\r\n                    var url = attributes.uniqueAsyncValidator;\r\n\r\n                    return $http.post(url, { id: modelId, value: modelValue }).then(function (response) {\r\n                        if (response.data === true) {\r\n                            return $q.resolve();\r\n                        } else {\r\n                            return $q.reject();\r\n                        }\r\n                    });\r\n                };\r\n            }\r\n        };\r\n    }])\r\n    .directive('uniqueAsyncValidatorWithData', ['$q', '$http', '$state', function ($q, $http, $state) {\r\n          return {\r\n              restrict: 'A',\r\n              require: 'ngModel',\r\n              link: function (scope, element, attributes, ngModel) {\r\n                  ngModel.$asyncValidators.uniqueAsyncValidatorWithData = function (modelValue) {\r\n\r\n                      if (!ngModel.$dirty) {\r\n                          return $q.resolve();\r\n                      }\r\n\r\n                      var validatorData = scope.$eval(attributes.validatorData);\r\n                      if (validatorData.ready !== undefined && !validatorData.ready) {\r\n                          return $q.resolve();\r\n                      }\r\n\r\n                      var url = attributes.uniqueAsyncValidatorWithData;\r\n                      var data = angular.extend({ value: modelValue }, validatorData.data);\r\n\r\n                      return $http.post(url, data).then(function (response) {\r\n                          (validatorData.callback || angular.noop)(response.data);\r\n\r\n                          var isValid = _.isBoolean(response.data)\r\n                            ? response.data : response.data.isValid;\r\n\r\n                          if (isValid === true) {\r\n                              return $q.resolve();\r\n                          } else {\r\n                              return $q.reject();\r\n                          }\r\n                      });\r\n                  };\r\n              }\r\n          };\r\n      }])\r\n    .directive('uniqueWithParentAsyncValidator', ['$q', '$http', function ($q, $http) {\r\n        return {\r\n            restrict: 'A',\r\n            require: 'ngModel',\r\n            link: function (scope, element, attributes, ngModel) {\r\n                ngModel.$asyncValidators.uniqueWithParentAsyncValidator = function (modelValue) {\r\n\r\n                    var modelId = scope.$eval(attributes.modelId);\r\n                    var modelParentId = scope.$eval(attributes.modelParentId);\r\n                    var url = attributes.uniqueWithParentAsyncValidator;\r\n\r\n                    return $http.post(url, { id: modelId, parentId: modelParentId, value: modelValue })\r\n                         .then(function (response) {\r\n                             if (response.data === true) {\r\n                                 return $q.resolve();\r\n                             } else {\r\n                                 return $q.reject();\r\n                             }\r\n                         });\r\n                };\r\n            }\r\n        };\r\n    }]);\nangular\r\n    .module('dsrCommon')\r\n    .factory('requestInterceptor', ['$templateCache', 'BackendRootUrl', function ($templateCache, BackendRootUrl) {\r\n\r\n        function appendVersion(url) {\r\n            var queryParameterSeparator = url.indexOf('?') === -1 ? '?' : '&';\r\n            return url + queryParameterSeparator + 'v=' + new Date().getTime();\r\n        }\r\n\r\n        return {\r\n            request: function (config) {\r\n                var isTemplateCacheRequest = (config.method === 'GET' && $templateCache.get(config.url) !== undefined);\r\n\r\n                if (!isTemplateCacheRequest) {\r\n                    var url = BackendRootUrl + config.url;\r\n                    url = url.replace('//', '/');\r\n\r\n                    config.url = appendVersion(url);\r\n                }\r\n\r\n                config.headers['X-Requested-With'] = 'XMLHttpRequest';\r\n\r\n                return config;\r\n            }\r\n        }\r\n    }]);\nangular\r\n    .module('dsrCommon')\r\n    .factory('responseNotificationInterceptor', ['$injector', function ($injector) {\r\n        return {\r\n            response: function(response) {\r\n                if (response.headers('notification-response')) {\r\n                    var toastrWrapper = $injector.get('toastrWrapper');\r\n                    toastrWrapper.showNotification(response.data.notificationType, response.data.message);\r\n                }\r\n\r\n                return response;\r\n            }\r\n        }\r\n    }]);\nangular\r\n    .module('dsrCommon')\r\n    .factory('responseErrorInterceptor', ['$q', '$window', '$injector', function ($q, $window, $injector) {\r\n        return {\r\n            responseError: function (response) {\r\n                var toastrWrapper = $injector.get('toastrWrapper');\r\n\r\n                if (response.status === 401) {\r\n                    $window.location.reload();\r\n                }\r\n                else if (response.status === 403) {\r\n                    toastrWrapper.showTranslatedError('common.accessForbidden');\r\n                }\r\n                else if (response.status === 404) {\r\n                    toastrWrapper.showTranslatedError('common.notFoundProblem', { url: response.config.url });\r\n                }\r\n                else if (!response.data || !response.data.message === undefined) {\r\n                    toastrWrapper.showTranslatedError('common.serverResponseProblem');\r\n                }\r\n                else if (response.data.validationData) {\r\n                    toastrWrapper.showValidationError(response.data.message, response.data.validationData);\r\n                }\r\n                else if (response.data.isMessageKey) {\r\n                    toastrWrapper.showTranslatedError(response.data.message);\r\n                }\r\n                else {\r\n                    toastrWrapper.showError(response.data.message);\r\n                }\r\n\r\n                return $q.reject(response);\r\n            }\r\n        }\r\n    }]);\nangular\r\n    .module('dsrCommon')\r\n    .factory('progressIndicatorInterceptor', ['$injector', '$q', function ($injector, $q) {\r\n        return {\r\n            request: function (config) {\r\n                config.progressActionId = $injector.get('progressIndicatorService').start();\r\n                return config;\r\n            },\r\n            response: function (response) {\r\n                $injector.get('progressIndicatorService').stop(response.config.progressActionId);\r\n                return response;\r\n            },\r\n            responseError: function (response) {\r\n                $injector.get('progressIndicatorService').stop(response.config.progressActionId);\r\n                return $q.reject(response);\r\n            }\r\n        };\r\n    }]);\nangular\r\n    .module('dsrCommon')\r\n    .filter('formattedDate', ['GlobalConfiguration', function (GlobalConfiguration) {\r\n        return function (inputValue) {\r\n            return inputValue ? moment(inputValue).format(GlobalConfiguration.dateFormat) : '';\r\n        };\r\n    }]);\r\n\nangular\r\n    .module('dsrCommon')\r\n    .filter('formattedDateTime', ['GlobalConfiguration', function (GlobalConfiguration) {\r\n        return function (inputValue) {\r\n            return inputValue ? moment(inputValue).format(GlobalConfiguration.dateTimeFormat) : '';\r\n        };\r\n    }])\r\n    .filter('formattedDateTimeWithSeconds', ['GlobalConfiguration', function (GlobalConfiguration) {\r\n        return function (inputValue) {\r\n            return inputValue ? moment(inputValue).format(GlobalConfiguration.dateTimeWithSecondsFormat) : '';\r\n        };\r\n    }]);\r\n\nangular\r\n    .module('dsrCommon')\r\n    .filter('hasPermission', ['permissionService', function (permissionService) {\r\n        return function (permissionName) {\r\n            var hasPermission = permissionService.hasPermission(permissionName);\r\n            return hasPermission;\r\n        }\r\n    }]);\nangular\r\n    .module('dsrCommon')\r\n    .filter('parenthesesWrapper', function () {\r\n        return function (inputValue) {\r\n            return inputValue ? '(' + inputValue + ')' : inputValue;\r\n        };\r\n    });\nangular\r\n    .module('dsrCommon')\r\n    .filter('minutesToFormattedTime', ['GlobalConfiguration', function (GlobalConfiguration) {\r\n        return function (inputValue) {\r\n            return _.isNumber(inputValue)\r\n                ? moment(0).hours(0).minutes(inputValue).format('HH:mm')\r\n                : '-';\r\n        };\r\n    }])\r\n    .filter('durationInSecondsToFormattedTime', ['leadingZerosFilter', function (leadingZerosFilter) {\r\n         return function (inputValue) {\r\n             if (_.isNumber(inputValue)) {\r\n                 var valueInMinutes = Math.floor(inputValue / 60);\r\n                 var hours = Math.floor(valueInMinutes / 60);\r\n                 var minutes = valueInMinutes % 60;\r\n                 return leadingZerosFilter(hours, 2) + \":\" + leadingZerosFilter(minutes, 2);\r\n             }\r\n         };\r\n     }])\r\n    .filter('leadingZeros', [function () {\r\n        return function (inputValue, size) {\r\n            var s = String(inputValue);\r\n\r\n            while (s.length < (size || 2)) {\r\n                s = \"0\" + s;\r\n            }\r\n\r\n            return s;\r\n        };\r\n    }]);\nangular\r\n    .module('dsrDuration', ['pascalprecht.translate']);\r\n\nangular\r\n    .module('dsrDuration')\r\n    .factory('durationHelper', ['$translate', function ($translate) {\r\n        return {\r\n            hoursToString: function (valueInHours) {\r\n                var days = Math.floor(valueInHours / 24),\r\n                    hours = valueInHours % 24;\r\n\r\n                return [\r\n                    days, $translate.instant('common.duration.days'),\r\n                    hours, $translate.instant('common.duration.hours')\r\n                ].join(' ');\r\n            },\r\n\r\n            minutesToString: function (valueInMinutes) {\r\n                var hours = Math.floor(valueInMinutes / 60),\r\n                    minutes = valueInMinutes % 60;\r\n\r\n                return [\r\n                    hours, $translate.instant('common.duration.hours'),\r\n                    minutes, $translate.instant('common.duration.minutes')\r\n                ].join(' ');\r\n            }\r\n        }\r\n    }]);\nangular\r\n    .module('dsrDuration')\r\n    .directive('durationLabel', ['durationHelper', function (durationHelper) {\r\n\r\n        var textProvider = {\r\n            'minutes': durationHelper.minutesToString,\r\n            'hours': durationHelper.hoursToString\r\n        };\r\n\r\n        return {\r\n            restrict: 'A',\r\n            scope: {\r\n                value: '<durationLabel',\r\n                unit: '@durationUnit'\r\n            },\r\n            link: function (scope, element, attrs) {\r\n\r\n                function setText() {\r\n                    var text = textProvider[scope.unit](scope.value);\r\n                    element.text(text);\r\n                }\r\n\r\n                setText();\r\n\r\n                scope.$watch('value', function () {\r\n                    setText();\r\n                });\r\n            }\r\n        }\r\n    }]);\nangular\r\n    .module('dsrDuration')\r\n    .directive('durationPicker', ['$timeout', '$translate', 'durationHelper', function ($timeout, $translate, durationHelper) {\r\n        function Value(step) {\r\n            this.value = 0;\r\n            this.step = step || 1;\r\n\r\n            this.increment = function () {\r\n                var newValue = this.value + this.step;\r\n                this.value = newValue - (newValue % this.step);\r\n            };\r\n\r\n            this.decrement = function () {\r\n                if (this.value > 0) {\r\n                    var r = this.value % this.step;\r\n                    var newValue = r > 0\r\n                        ? this.value - r\r\n                        : this.value - this.step;\r\n\r\n                    this.value = Math.max(0, newValue);\r\n                }\r\n            };\r\n        }\r\n\r\n        return {\r\n            templateUrl: '/Content/DSRToolkit/Core/Scripts/Duration/templates/_durationPickerTemplate.html',\r\n            scope: {\r\n                durationValue: '=',\r\n                durationUnit: '@', // hours | minutes\r\n                durationStep: '@'\r\n            },\r\n            link: function (scope, element, attrs) {\r\n\r\n                var textInput = element.find('input[type=text]');\r\n\r\n                textInput.on('focus', function () {\r\n                    scope.$apply(function () {\r\n                        scope.isOpen = true;\r\n\r\n                        $timeout(function () {\r\n                            element.find('.popover-content input:first').focus();\r\n                        }, 100);\r\n                    });\r\n                });\r\n\r\n                element.find('.input-group-addon').on('click', function () {\r\n                    textInput.focus();\r\n                });\r\n\r\n                scope.onKeyUp = function (event, value, isLast) {\r\n                    if (event.keyCode === 38) {\r\n                        value.increment();\r\n\r\n                    } else if (event.keyCode === 40) {\r\n                        value.decrement();\r\n                    }\r\n                };\r\n\r\n                scope.closeOnTabPress = function (event) {\r\n                    if (event.keyCode === 9) {\r\n                        scope.isOpen = false;\r\n                    }\r\n                };\r\n\r\n                scope.hide = function () {\r\n                    scope.isOpen = false;\r\n                };\r\n\r\n                var isMinutesUnit = scope.durationUnit === 'minutes';\r\n\r\n                scope.value1 = new Value();\r\n                scope.value2 = new Value(parseInt(scope.durationStep));\r\n                scope.value1Label = $translate.instant(isMinutesUnit ? 'common.duration.hours' : 'common.duration.days')\r\n                scope.value2Label = $translate.instant(isMinutesUnit ? 'common.duration.minutes' : 'common.duration.hours');\r\n\r\n                var parentSize = isMinutesUnit ? 60 : 24;\r\n                var textProvider = isMinutesUnit ? durationHelper.minutesToString : durationHelper.hoursToString;\r\n\r\n                scope.$watchGroup(['value1.value', 'value2.value'], function (newValues) {\r\n                    var value = scope.value1.value * parentSize + scope.value2.value;\r\n\r\n                    scope.textInputValue = textProvider(value);\r\n                    scope.durationValue = value;\r\n                });\r\n\r\n                scope.$watch('durationValue', function (newValue, oldValue) {\r\n                    if (newValue === undefined || isNaN(newValue))\r\n                        return;\r\n\r\n                    scope.value1.value = Math.floor(newValue / parentSize);\r\n                    scope.value2.value = newValue % parentSize;\r\n                });\r\n            }\r\n        };\r\n    }]);\nangular\r\n    .module('dsrConfirmation', ['ui.bootstrap', 'pascalprecht.translate']);\r\n\nangular\r\n    .module('dsrConfirmation')\r\n    .factory('confirmationService', ['$uibModal', '$translate', function ($uibModal, $translate) {\r\n\r\n        function showConfirmationModal(confirmationMessage, warningMessage) {\r\n            return $uibModal.open({\r\n                component: 'confirmationModalComponent',\r\n                resolve: {\r\n                    confirmationMessage: function () {\r\n                        return confirmationMessage;\r\n                    },\r\n                    warningMessage: function () {\r\n                        return warningMessage;\r\n                    }\r\n                }\r\n            })\r\n        }\r\n\r\n        return {\r\n            showConfirmation: function (confirmationMessage) {\r\n                return showConfirmationModal(confirmationMessage);\r\n            },\r\n\r\n            showConfirmationWithWarning: function(confirmationMessage, warningMessage) {\r\n                return showConfirmationModal(confirmationMessage, warningMessage);\r\n            },\r\n\r\n            showTranslatedConfirmation: function (confirmationMessageKey) {\r\n                return showConfirmationModal($translate(confirmationMessageKey));\r\n            }\r\n        }\r\n    }]);\nangular\r\n    .module('dsrConfirmation')\r\n    .component('confirmationModalComponent', {\r\n        templateUrl: '/Content/DSRToolkit/Core/Scripts/Confirmation/templates/confirmationModalComponent.template.html',\r\n        bindings: {\r\n            resolve: '<',\r\n            close: '&',\r\n            dismiss: '&'\r\n        },\r\n        controller: function () {\r\n            var $ctrl = this;\r\n\r\n            $ctrl.$onInit = function () {\r\n                $ctrl.confirmationMessage = $ctrl.resolve.confirmationMessage;\r\n                $ctrl.warningMessage = $ctrl.resolve.warningMessage;\r\n            }\r\n        }\r\n    });\nangular\r\n    .module('dsrDataTables', ['datatables', 'datatables.bootstrap', 'toastr']);\r\n\nangular\r\n    .module('dsrDataTables')\r\n    .factory('genericDataTableAjaxProvider', ['$http', 'toastrWrapper', function ($http, toastrWrapper) {\r\n        var errorCallback = function (callback) {\r\n            callback({ recordsTotal: 0, recordsFilterd: 0, data: [] });\r\n        };\r\n\r\n        return function (url) {\r\n            return function (data, callback, settings) {\r\n                $http.post(url, data)\r\n                     .then(function (response) {\r\n                         if (response.data.error) {\r\n                             errorCallback(callback);\r\n                             toastrWrapper.showError(response.data.error);\r\n                         } else {\r\n                             callback(response.data);\r\n                         }\r\n                     }, function () {\r\n                         errorCallback(callback);\r\n                     });\r\n            };\r\n        }\r\n    }]);\nangular\r\n    .module('dsrDataTables')\r\n    .factory('dataTableHelper', function () {\r\n\r\n        function toggleAll() {\r\n            var that = this;\r\n\r\n            _.each(_.keys(this.selected), function (id) {\r\n                that.selected[id] = that.selectAll;\r\n            });\r\n        }\r\n\r\n        function toggleOne(id) {\r\n            this.selected[id] = !this.selected[id];\r\n            this.checkIfAllSelected();\r\n        }\r\n\r\n        function whateverTrue() {\r\n            return true;\r\n        }\r\n        function whateverFalse() {\r\n            return false;\r\n        }\r\n\r\n        function checkIfAllSelected() {\r\n            this.selectAll = this.allRowSelected();\r\n        }\r\n\r\n        function isAnyRowSelected() {\r\n            return _.some(_.values(this.selected));\r\n        }\r\n\r\n        function allRowSelected() {\r\n            return _.all(_.values(this.selected));\r\n        }\r\n\r\n        function onlyOneSelected() {\r\n            var selectedItems = this.getSelectedItemIds();\r\n            return selectedItems.length === 1;\r\n        }\r\n\r\n        function getFunctionSelected(name) {\r\n            var fcn = this[name];\r\n            if (!fcn) {\r\n                var e = { name: 'Bad name exception', message: 'The name ' + name + ' is not a member of dataTableHelper module. Check the code and use proper name.' }\r\n                throw e;\r\n                console.error(e);\r\n            }\r\n            return fcn.call(this);\r\n        }\r\n\r\n        function getSelectedItemIds() {\r\n            var that = this;\r\n            var selectedItemIds = [];\r\n\r\n            _.each(_.keys(this.selected), function (id) {\r\n                if (that.selected[id] === true) {\r\n                    selectedItemIds.push(id);\r\n                }\r\n            });\r\n\r\n            return selectedItemIds;\r\n        }\r\n\r\n        function unselectAll() {\r\n            this.selectAll = false;\r\n            this.toggleAll();\r\n        }\r\n\r\n        function clear() {\r\n            this.selected = {};\r\n            this.selectAll = false;\r\n            this.toggleAll();\r\n        }\r\n\r\n        function prepareModelForTable() {\r\n            return {\r\n                selected: {},\r\n                selectAll: false,\r\n                toggleAll: toggleAll,\r\n                toggleOne: _.throttle(toggleOne, 300),\r\n                checkIfAllSelected: checkIfAllSelected,\r\n                isAnyRowSelected: isAnyRowSelected,\r\n                allRowSelected: allRowSelected,\r\n                onlyOneSelected: onlyOneSelected,\r\n                getSelectedItemIds: getSelectedItemIds,\r\n                getFunctionSelected: getFunctionSelected,\r\n                clear: clear,\r\n                whateverFalse: whateverFalse,\r\n                whateverTrue: whateverTrue\r\n            };\r\n        }\r\n\r\n        return {\r\n            prepareModelForTable: prepareModelForTable\r\n        };\r\n    });\r\n\nangular\r\n    .module('dsrDataTables')\r\n    .factory('datatablesConfigurationService', ['DTDefaultOptions', 'BackendRootUrl', 'CurrentLanguage', function (DTDefaultOptions, BackendRootUrl, CurrentLanguage) {\r\n        return function () {\r\n\r\n            DTDefaultOptions.setLanguage({\r\n                url: BackendRootUrl + 'Content/Vendor/datatables/i18n/' + CurrentLanguage + '.json'\r\n            });\r\n        };\r\n    }]);\nangular\r\n    .module('dsrDataTables')\r\n    .directive('datatablesBindAngularFix', ['$compile', '$timeout', function ($compile, $timeout) {\r\n        return {\r\n            restrict: 'A',\r\n            link: function (scope, element, attr) {\r\n\r\n                var childScope = null;\r\n\r\n                function onPreDraw() {\r\n                    if (childScope !== null) {\r\n                        childScope.$destroy();\r\n                        childScope = null;\r\n                        if (attr.preDrawCallback) {\r\n                            $timeout(function () {\r\n                                scope.$apply(attr.preDrawCallback);\r\n                            });\r\n\r\n                        }\r\n                    }\r\n                }\r\n\r\n                function onDraw() {\r\n                    childScope = scope.$new();\r\n\r\n                    $compile(element.find('thead'))(childScope);\r\n                    $compile(element.find('tbody'))(childScope);\r\n                }\r\n\r\n                element\r\n                    .on('preDraw.dt', onPreDraw)\r\n                    .on('draw.dt', onDraw);\r\n            }\r\n        }\r\n    }]);\r\n\nangular\r\n    .module('dsrDataTables')\r\n    .directive('datatablesProcessingIndicator', function () {\r\n        return {\r\n            restrict: 'A',\r\n            link: function (scope, element) {\r\n                element.on('processing.dt', function (e, settings, processing) {\r\n                    if (processing) {\r\n                        var processingIndicator = angular.element(settings.nTableWrapper).find('.dataTables_processing');\r\n                        processingIndicator.css('color', 'gray')\r\n                        processingIndicator.html('<i class=\"fa fa-spinner fa-pulse fa-3x fa-fw\"></i>');\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    });\r\n\nangular\r\n    .module('dsrDataTables')\r\n    .component('datatable', {\r\n        template: '<table id=\"def\" datatable=\"\" dt-options=\"$dataTableCtrl.dtOptions\" dt-columns=\"$dataTableCtrl.dtColumns\" dt-instance=\"$dataTableCtrl.dataTableInstance\"'\r\n                + ' datatables-bind-angular-fix pre-draw-callback=\"$dataTableCtrl.options.table.clear()\" datatables-processing-indicator'\r\n                + ' class=\"table stylized-table\"></table>',\r\n        bindings: {\r\n            options: '='\r\n        },\r\n        controllerAs: '$dataTableCtrl',\r\n        controller: ['DTOptionsBuilder', 'DTColumnBuilder', 'genericDataTableAjaxProvider', 'dataTableHelper',\r\n            function (DTOptionsBuilder, DTColumnBuilder, genericDataTableAjaxProvider, dataTableHelper) {\r\n                var vm = this;\r\n\r\n                vm.dataTableInstance = {};\r\n                vm.options.table = dataTableHelper.prepareModelForTable();\r\n                vm.rowsData = [];\r\n\r\n                var modelId = vm.options.modelId || 'id';\r\n                var titleHtml = '<input ng-model=\"$dataTableCtrl.options.table.selectAll\" ng-click=\"$dataTableCtrl.options.table.toggleAll()\" type=\"checkbox\" icheck  />';\r\n\r\n                vm.dtOptions = DTOptionsBuilder.newOptions()\r\n                    .withOption('ajax', genericDataTableAjaxProvider(vm.options.tableDataUrl))\r\n                    .withDataProp('data')\r\n                    .withOption('paging', true)\r\n                    .withOption('stateSave', true)\r\n                    .withOption('stateDuration', -1)\r\n                    .withOption('processing', true)\r\n                    .withOption('serverSide', true)\r\n                    .withOption('createdRow', function (row, data, index) {\r\n                        var rowElement = angular.element(row);\r\n                        rowElement.attr('ng-class', '{\"selected\" : $dataTableCtrl.options.table.selected[\\'' + data[modelId] + '\\']}');\r\n                        rowElement.attr('ng-click', '$dataTableCtrl.options.table.toggleOne(\\'' + data[modelId] + '\\')');\r\n                        rowElement.attr('ng-dblclick', '$dataTableCtrl.options.goToDetails(\\'' + data[modelId] + '\\')');\r\n\r\n                        vm.rowsData[index] = data;\r\n                    })\r\n                    .withPaginationType('full_numbers')\r\n                    .withBootstrap();\r\n\r\n                function getSelectColumn(modelId) {\r\n                    return DTColumnBuilder\r\n                        .newColumn(modelId)\r\n                        .withTitle(titleHtml)\r\n                        .notSortable()\r\n                        .withClass('select-checkbox')\r\n                        .renderWith(function (data, type, full, meta) {\r\n                            var key = full[modelId];\r\n                            vm.options.table.selected[key] = false;\r\n                            return '<input ng-model=\"$dataTableCtrl.options.table.selected[\\'' + key + '\\']\" ng-click=\"$dataTableCtrl.options.table.checkIfAllSelected()\" type=\"checkbox\" icheck />';\r\n                        });\r\n                }\r\n\r\n                vm.options.columns.splice(0, 0, getSelectColumn(modelId));\r\n                vm.dtColumns = vm.options.columns;\r\n            }\r\n        ]\r\n    });\nangular\r\n    .module('dsrLayout', ['ngCookies']);\r\n\nangular\r\n    .module('dsrLayout')\r\n    .directive('menuToggle', ['$cookies', function ($cookies) {\r\n        return {\r\n            restrict: 'EA',\r\n            transclude: true,\r\n            link: function (scope, element, attrs, ctrl, transclude) {\r\n                var bodyElement = $('body');\r\n                var sidebarMenuElement = $('#sidebarMenu');\r\n\r\n                element.append(transclude());\r\n                element.on('click', function () {\r\n                    if (bodyElement.hasClass('nav-md')) {\r\n                        sidebarMenuElement.find('li.active ul').hide();\r\n                        sidebarMenuElement.find('li.active').addClass('active-sm').removeClass('active');\r\n                    } else {\r\n                        sidebarMenuElement.find('li.active-sm > ul').show();\r\n                        sidebarMenuElement.find('li.active-sm').addClass('active').removeClass('active-sm');\r\n                    }\r\n\r\n                    bodyElement.toggleClass('nav-md nav-sm');\r\n\r\n                    var menuSizeClass = bodyElement.hasClass('nav-md') ? 'nav-md' : 'nav-sm';\r\n                    $cookies.put('dsr.menu-size', menuSizeClass, { path: '/' });\r\n                });\r\n            }\r\n        };\r\n    }]);\nangular\r\n    .module('dsrLayout')\r\n    .directive('sidebarMenu', ['$http', '$timeout', function ($http, $timeout) {\r\n        return {\r\n            restrict: 'EA',\r\n            transclude: true,\r\n            link: function (scope, element, attrs, ctrl, transclude) {\r\n\r\n                function attachActivationSupport() {\r\n                    element.find('a').on('click', function () {\r\n                        var listItem = $(this).parent();\r\n\r\n                        if (listItem.is('.active')) {\r\n                            listItem.removeClass('active active-sm');\r\n                            listItem.find('ul:first').slideUp();\r\n                        } else {\r\n                            // prevent closing menu if we are on child menu\r\n                            if (!listItem.parent().is('.child_menu')) {\r\n                                element.find('li').removeClass('active active-sm');\r\n                                element.find('li ul').slideUp();\r\n                            }\r\n\r\n                            listItem.addClass('active');\r\n\r\n                            listItem.find('ul:first').slideDown();\r\n                        }\r\n                    });\r\n                }\r\n\r\n                element.append(transclude());\r\n\r\n                attachActivationSupport();\r\n\r\n                scope.$root.$on('reload-menu', function (event) {\r\n                    $timeout(function () {\r\n                        $http.get('/Home/Menu').then(function (response) {\r\n                            element.empty().html(response.data);\r\n                            attachActivationSupport();\r\n                        });\r\n                    });\r\n\r\n                });\r\n            }\r\n        };\r\n    }]);"]}